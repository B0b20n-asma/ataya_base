

{% extends "bmab/base.html" %}

{% block title %}View Member{% endblock %}

{% block content %}
<h2>Member Details</h2>

<!-- Export buttons -->
<div class="mb-4">
    <button id="printBtn" class="btn btn-outline-primary">
        <i class="fas fa-print"></i> Print Details
    </button>
    <button id="pdfBtn" class="btn btn-outline-danger">
        <i class="fas fa-file-pdf"></i> Export to PDF
    </button>
    <button id="excelBtn" class="btn btn-outline-success">
        <i class="fas fa-file-excel"></i> Export to Excel
    </button>
</div>

<table class="table table-bordered">
    <tr>
        <th>Number</th>
        <td>{{ member.number }}</td>
    </tr>
    <tr>
        <th>Name</th>
        <td>{{ member.name }}</td> <!-- corrected -->
    </tr>
    <tr>
        <th>Address</th>
        <td>{{ member.address }}</td>
    </tr>
    <tr>
        <th>Phone Number</th>
        <td>{{ member.phone_number }}</td>
    </tr>
    <tr>
        <th>Registration Fee</th>
        <td>{{ member.registration_fee }}</td>
    </tr>

    <!-- Monthly contributions -->
    <tr><th>January</th><td>{{ member.Jan }}</td></tr>
    <tr><th>February</th><td>{{ member.Feb }}</td></tr>
    <tr><th>March</th><td>{{ member.Mar }}</td></tr>
    <tr><th>April</th><td>{{ member.Apr }}</td></tr>
    <tr><th>May</th><td>{{ member.May }}</td></tr>
    <tr><th>June</th><td>{{ member.Jun}}</td></tr>
    <tr><th>July</th><td>{{ member.Jul}}</td></tr>
    <tr><th>August</th><td>{{ member.Aug}}</td></tr>
    <tr><th>September</th><td>{{ member.Sep }}</td></tr>
    <tr><th>October</th><td>{{ member.Oct}}</td></tr>
    <tr><th>November</th><td>{{ member.Nov }}</td></tr>
    <tr><th>December</th><td>{{ member.Dec }}</td></tr>
</table>

<a href="{% url 'dashboard' %}" class="btn btn-secondary"
   onclick="return confirm('Are you sure you want to return to the dashboard?');">Back</a>

<!-- Include necessary libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<script>
// Function to print the member details
document.getElementById('printBtn').addEventListener('click', function() {
    window.print();
});

// Function to export to PDF
document.getElementById('pdfBtn').addEventListener('click', function() {
    // Initialize jsPDF
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    // Add title
    doc.setFontSize(16);
    doc.text('Member Details - ' + '{{ member.name }}', 14, 15);
    
    // Add member details
    doc.setFontSize(12);
    
    let memberData = [
        ['Member Number', '{{ member.number }}'],
        ['Name', '{{ member.name }}'],
        ['Address', '{{ member.address }}'],
        ['Phone Number', '{{ member.phone_number }}'],
        ['Registration Fee', '{{ member.registration_fee }}']
    ];
    
    doc.autoTable({
        startY: 25,
        head: [['Field', 'Value']],
        body: memberData,
        theme: 'grid'
    });
    
    // Add monthly contributions
    let finalY = doc.lastAutoTable.finalY + 10;
    doc.text('Monthly Contributions', 14, finalY);
    
    let contributionsData = [
        ['January', '{{ member.Jan }}'],
        ['February', '{{ member.Feb }}'],
        ['March', '{{ member.Mar }}'],
        ['April', '{{ member.Apr }}'],
        ['May', '{{ member.May }}'],
        ['June', '{{ member.Jun }}'],
        ['July', '{{ member.Jul }}'],
        ['August', '{{ member.Aug }}'],
        ['September', '{{ member.Sep }}'],
        ['October', '{{ member.Oct }}'],
        ['November', '{{ member.Nov }}'],
        ['December', '{{ member.Dec }}']
    ];
    
    doc.autoTable({
        startY: finalY + 5,
        head: [['Month', 'Contribution']],
        body: contributionsData,
        theme: 'grid'
    });
    
    // Save the PDF
    doc.save('Member_Details_{{ member.name }}_{{ member.number }}.pdf');
});

// Function to export to Excel
document.getElementById('excelBtn').addEventListener('click', function() {
    // Prepare data for Excel
    const memberData = [
        ['Member Details'],
        ['Number', '{{ member.number }}'],
        ['Name', '{{ member.name }}'],
        ['Address', '{{ member.address }}'],
        ['Phone Number', '{{ member.phone_number }}'],
        ['Registration Fee', '{{ member.registration_fee }}'],
        [''], // Empty row for spacing
        ['Monthly Contributions'],
        ['January', '{{ member.Jan }}'],
        ['February', '{{ member.Feb }}'],
        ['March', '{{ member.Mar }}'],
        ['April', '{{ member.Apr }}'],
        ['May', '{{ member.May }}'],
        ['June', '{{ member.Jun }}'],
        ['July', '{{ member.Jul }}'],
        ['August', '{{ member.Aug }}'],
        ['September', '{{ member.Sep }}'],
        ['October', '{{ member.Oct }}'],
        ['November', '{{ member.Nov }}'],
        ['December', '{{ member.Dec }}']
    ];
    
    // Create worksheet
    const ws = XLSX.utils.aoa_to_sheet(memberData);
    
    // Create workbook
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Member Details');
    
    // Generate Excel file and download
    XLSX.writeFile(wb, 'Member_Details_{{ member.name }}_{{ member.number }}.xlsx');
});
</script>

<style>
@media print {
    .btn, #printBtn, #pdfBtn, #excelBtn {
        display: none !important;
    }
    
    body {
        font-size: 12pt;
        background: white;
    }
    
    .table {
        border: 1px solid #000;
        font-size: 10pt;
    }
    
    .table th, .table td {
        border: 1px solid #000;
        padding: 4px;
    }
    
    h2 {
        color: #000;
    }
}
</style>
{% endblock %}